<div class="box">
  <div class="head-wrap" *ngIf="feed.communityDTO">
    <div class="profile-icon"> <img [src]="feed.communityDTO?.avatarDTO?.avatarLink ?
      feed.communityDTO?.avatarDTO?.avatarLink : 'assets/default.jpg'" alt=""> </div>
    <div class="profile-detail" *ngIf="feed.communityDTO">
      <div class="head">{{feed.communityDTO?.communityName}}</div>
      <div class="subhead"> Posted in Community - {{feed.metaData.actionDate}} </div>
    </div>
  </div>
  <div class="head-wrap" *ngIf="!feed.communityDTO">
    <div class="profile-icon"> <img [src]="feed.userDTO?.avatarDTO?.avatarLink ?
      feed.userDTO?.avatarDTO?.avatarLink : 'assets/default.jpg'" alt=""> </div>
    <div class="profile-detail">
      <div class=" head">{{feed.userDTO?.username | titlecase}}</div>
      <div class="subhead" [matTooltip]="feed.metaData.timeInUTC | date"> {{feed.metaData.timeString}} ago</div>
    </div>
  </div>
  <div class="main">
    <div class="text" [innerHtml]="feed?.text"> </div>
    <div *ngIf="feed.postMediaDTOList.length">
      <img class="w-100" [src]="feed.postMediaDTOList[0].postMediaLink" alt="">
    </div>
  </div>
  <mat-progress-bar mode="indeterminate" color="accent" *ngIf="isLoading" style="margin-bottom:-4px">
  </mat-progress-bar>
  <div class="footer-wrap">
    <button mat-button [disabled]="isLoading" (click)="likePost(feed.postActionId)" [ngClass]="isLiked? 'liked':''">
      <mat-icon [innerHtml]="isLiked?'favorite' :'favorite_border'"></mat-icon> &nbsp;
      <span [innerHtml]="isLiked?'Liked' :'Like'"> Like </span>
    </button>
    <button mat-button (click)="toggleComments(feed.postActionId)">
      <mat-icon>insert_comment</mat-icon> &nbsp;
      <span> Comment </span>
    </button>
    <button mat-button>
      <mat-icon>share</mat-icon> &nbsp;
      <span> Share </span>
    </button>
  </div>
  <div class="comments" [@expand]="isCommenting ? 'expanded' : 'collapsed'">
    <hr>
    <div class="wrap">
      <div *ngIf="feed.commentActionDTOList.length && !isCommentLoading;  else noComments">
        <div class="comment-box" *ngFor="let comment of feed.commentActionDTOList"
          [ngClass]="comment.userActorDTO?.userId === getUserId()? 'myComment' : ''">
          <div class=" head-wrap">
            <div class="profile-icon"> <img [src]="comment.userActorDTO?.avatarDTO?.avatarLink ?
              comment.userActorDTO?.avatarDTO?.avatarLink : 'assets/default.jpg'" alt=""> </div>
            <div class="profile-detail">
              <div class=" head">{{comment.userActorDTO?.username | titlecase}}</div>
              <div class="subhead" [matTooltip]="comment.metaData.timeInUTC | date"> {{comment.metaData.timeString}} ago
              </div>
            </div>
          </div>
          <div class="main-body"> {{comment.commentObject}} </div>
        </div>
      </div>
      <ng-template #noComments>
        <div class="loader">
          <mat-spinner *ngIf="isCommentLoading"></mat-spinner>
        </div>
        <p class="text-center" *ngIf="!feed?.commentActionDTOList?.length && !isCommentLoading">No Comments Found...!
        </p>
      </ng-template>
      <div class="comment-wrapper">
        <input type="text" placeholder="Write a Comment..." [formControl]="comment">
        <button mat-flat-button color="accent" (click)="postComment(feed.postActionId)" [disabled]="!comment.valid">
          <mat-icon>send</mat-icon>
        </button>
      </div>
    </div>
  </div>
</div>
