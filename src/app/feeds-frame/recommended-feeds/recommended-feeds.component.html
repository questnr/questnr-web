<div class="box">
  <div class="head-wrap" *ngIf="feed.communityDTO">
    <div class="profile-icon"> <img [src]="feed.communityDTO?.avatarDTO?.avatarLink ?
      feed.communityDTO?.avatarDTO?.avatarLink : 'assets/default.jpg'" alt=""> </div>
    <div class="profile-detail" *ngIf="feed.communityDTO">
      <div class="head">{{feed.communityDTO?.communityName}}</div>
      <div class="subhead"> Posted in Community -
        <span [matTooltip]="feed.metaData.timeInUTC | date">{{feed.metaData.timeString}} ago</span>
      </div>
    </div>
  </div>
  <div class="head-wrap" *ngIf="!feed.communityDTO">
    <div class="profile-icon"> <img [src]="feed.userDTO?.avatarDTO?.avatarLink ?
      feed.userDTO?.avatarDTO?.avatarLink : 'assets/default.jpg'" alt=""> </div>
    <div class="profile-detail">
      <div class=" head">{{feed.userDTO?.username}}</div>
      <div class="subhead" [matTooltip]="feed.metaData.timeInUTC | date"> {{feed.metaData.timeString}} ago</div>
    </div>
  </div>
  <div class="mb-2">
    <div class="text" *ngIf="feed?.text && feed.text !== 'null'" [innerHtml]="feed?.text"> </div>
    <div *ngIf="feed.postMediaList?.length">
      <owl-carousel-o [options]="customOptions">
        <ng-container *ngFor="let media of feed.postMediaList;let i=index">
          <ng-template carouselSlide [id]="i" *ngIf="media.mediaType === 'image'">
            <img class="w-100" [src]="media.postMediaLink" alt="">
          </ng-template>
          <ng-template carouselSlide [id]="i" *ngIf="media.mediaType === 'video'">
            <mat-video color="accent" [src]="media.postMediaLink"> </mat-video>
          </ng-template>
        </ng-container>
      </owl-carousel-o>
    </div>
  </div>
  <div class="count-box">
    <div> <span>{{feed.totalLikes? feed.totalLikes: 0}} </span>
      {{feed.totalLikes>1? 'Likes': 'Like'}}</div>
    <div class="dot"></div>
    <div> <span> {{feed.totalComments?feed.totalComments:0}} </span>
      {{feed.totalComments> 1? 'Comments': 'Comment'}} </div>
  </div>
  <div class="footer-wrap">
    <button mat-button [disabled]="isLoading" (click)="likePost(feed.postActionId)"
      [ngClass]="feed?.postActionMeta?.liked? 'liked':''">
      <mat-icon [innerHtml]="feed?.postActionMeta?.liked?'favorite' :'favorite_border'"></mat-icon> &nbsp;
      <span [innerHtml]="feed?.postActionMeta?.liked?'Liked' :'Like'"> Like </span>
    </button>
    <button mat-button (click)="toggleComments()">
      <mat-icon>insert_comment</mat-icon> &nbsp;
      <span> Comment </span>
    </button>
    <button mat-button (click)="toggleSharing()">
      <mat-icon>share</mat-icon> &nbsp;
      <span> Share </span>
    </button>
  </div>
  <div class="comments" [@expand]="isCommenting ? 'expanded' : 'collapsed'">
    <div class="wrap">
      <div *ngIf="feed.commentActionList?.length && !isCommentLoading;  else noComments">
        <div class="comment-box" *ngFor="let comment of feed.commentActionList"
          [ngClass]="comment.userActorDTO?.userId === getUserId()? 'myComment' : ''">
          <app-comment-box class="comment-item" [comment]="comment" [postId]="feed.postActionId"
            (update)="getComments(feed.postActionId)"></app-comment-box>
          <div class="subComments" *ngIf="comment.childCommentDTOSet?.length">
            <div class="child-comment" *ngFor="let item of comment.childCommentDTOSet">
              <app-comment-box class="comment-item"
                [ngClass]="item.userActorDTO?.userId === getUserId()? 'myComment' : ''" [comment]="item"
                [postId]="feed.postActionId" (update)="getComments(feed.postActionId)"></app-comment-box>
            </div>
          </div>
        </div>
      </div>
      <ng-template #noComments>
        <div class="loader">
          <mat-spinner *ngIf="isCommentLoading" color="accent"></mat-spinner>
        </div>
      </ng-template>
      <div class="comment-wrapper">
        <input type="text" [formControl]="comment" placeholder="Write a Comment..">
        <button mat-flat-button color="accent" (click)="postComment(feed.postActionId)" [disabled]="!comment.valid">
          <mat-icon>send</mat-icon>
        </button>
      </div>
    </div>
  </div>
  <div class="share" [@expand]="isSharing ? 'expanded' : 'collapsed'">

  </div>
</div>
