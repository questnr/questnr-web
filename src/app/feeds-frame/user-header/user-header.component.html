<!--header-->

<header id="extended-nav" class="nav-main-container">
  <div class="toolbar" role="banner">
    <div style="width: 32px; height: 32px; margin: auto 8px;" class="mobile_logo" [routerLink]="['/', feedPath]">
      <img src="/assets/logo.png" alt="logo" style="width: 100%">
    </div>
    <!--    <button class="toggle" mat-button (click)="toggleMenu()">-->
    <!--&lt;!&ndash;      <mat-icon>menu</mat-icon>&ndash;&gt;-->
    <!--      -->
    <!--    </button>-->
    <div class="logo" [routerLink]="['/', feedPath]"><img src="../../assets/main.png" /></div>
    <div class="spacer"></div>

    <div class="search-wrapper">
      <input type="text" placeholder="Type here to search..." [formControl]="searchInput" #searchInputRef>
      <mat-icon class="search-icon" (click)="searchEntity()">search</mat-icon>
      <div class="suggestions" #suggestionBoxRef>
        <mat-progress-bar mode="indeterminate" color="accent" *ngIf="isLoading" style="height: 2px"></mat-progress-bar>
        <div class="search-menu row">
          <div class="search-option-list row col-md-11">
            <div *ngFor="let item of filterSearchOptionList;let indexOfelement=index;" class="search-option col-md-3"
              (click)="selectSearchOption(indexOfelement)"
              [ngClass]="{'selected': indexOfelement==selectedSearchOption}">
              <app-dot [radius]="7"></app-dot><span>{{item}}</span>
            </div>
          </div>
          <mat-icon class="close-icon col-md-1" (click)="closeSearchBox()">close</mat-icon>
        </div>
        <div *ngIf="selectedSearchOption==0">
          <button class="w-100" mat-button *ngFor="let user of users" (click)="handleRouterLink(user?.slug)">
            <app-horizontal-profile
              [avatarLink]="user?.avatarDTO?.avatarLink ? user?.avatarDTO?.avatarLink : 'assets/default.jpg'"
              [head]="user?.username" [subhead]="user?.firstName+' '+user?.lastName">
            </app-horizontal-profile>
          </button>
        </div>
        <div *ngIf="selectedSearchOption==1">
          <button class="w-100" mat-button *ngFor="let community of communities"
            (click)="handleRouterLink(community?.slug)">
            <app-horizontal-profile
              [avatarLink]="community?.avatarDTO?.avatarLink ? community?.avatarDTO?.avatarLink : 'assets/default.jpg'"
              [head]="community?.communityName" [subhead]="community?.ownerUserDTO?.username">
            </app-horizontal-profile>
          </button>
        </div>
        <div *ngIf="selectedSearchOption==2">
          <button class="w-100" mat-button *ngFor="let hashTag of hashtags"
            (click)="handleRouterLink(hashTag.hashTagValue)">{{"#"+hashTag.hashTagValue}}</button>
        </div>
      </div>
    </div>

    <div class="spacer"></div>
    <button mat-button class="d-none d-sm-block d-md-block d-lg-block profile-btn"
      [routerLink]="['/', userPath, userDetail?.slug]">
      <div>
        <div class="icon">
          <img [src]="auth.profileImg" />
        </div>
        <span class="user_name">{{profile?.sub}}</span>
      </div>
    </button>
    <button mat-button class="d-none d-sm-block d-md-block d-lg-block h-100 explore-header"
      [routerLink]="['/', explorePath]">
      <img src="/assets/safari.svg" style=" width: 23px; margin-right: 10px; "> Explore
    </button>
    <button mat-button class="d-none d-sm-block d-md-block d-lg-block h-100 explore-header" (click)="createCommunity()">
      <img src="/assets/add.png" style=" width: 23px; margin-right: 10px; "> Create
    </button>
    <button mat-button class="d-none d-sm-block d-md-block d-lg-block h-100" [matMenuTriggerFor]="notificationsMenu"
      [style.color]="notificationAnswerColor" (click)="readNewNotificationAnswer()">

      <mat-icon *ngIf="!hasNewNotificationAnswers && unReadNotificationAnswerCount <= 0">
        contact_support
      </mat-icon>

      <mat-icon *ngIf="!hasNewNotificationAnswers && unReadNotificationAnswerCount > 0"
        matBadge="{{unReadNotificationAnswerCount}}" matBadgeColor="warn">
        contact_support
      </mat-icon>

      <mat-icon matBadge="{{unReadNotificationAnswerCount}}" matBadgeColor="warn" *ngIf="hasNewNotifications">
        contact_support
      </mat-icon>
      <!-- <div class="notification-answer-icon" *ngIf="!hasNewNotificationAnswers && unReadNotificationAnswerCount <= 0">
      <img src="/assets/question-mark-ios.png" />
    </div>

    <div class="notification-answer-icon" *ngIf="!hasNewNotificationAnswers && unReadNotificationAnswerCount > 0"
      matBadge="{{unReadNotificationAnswerCount}}" matBadgeColor="warn">
      <img src="/assets/question-mark-ios.png" />
    </div>

    <div class="notification-answer-icon" matBadge="{{unReadNotificationAnswerCount}}" matBadgeColor="warn"
      *ngIf="hasNewNotifications">
      <img src="/assets/question-mark-ios.png" />
    </div> -->
    </button>

    <button mat-button class="d-none d-sm-block d-md-block d-lg-block h-100" [matMenuTriggerFor]="notificationsMenu"
      [style.color]="notificationColor" (click)="readNewNotification()">
      <mat-icon *ngIf="!hasNewNotifications && unReadNotificationCount <= 0">notifications
      </mat-icon>

      <mat-icon *ngIf="!hasNewNotifications && unReadNotificationCount > 0" matBadge="{{unReadNotificationCount}}"
        matBadgeColor="warn">
        notifications
      </mat-icon>

      <mat-icon matBadge="{{unReadNotificationCount}}" matBadgeColor="warn" *ngIf="hasNewNotifications">
        notifications_active</mat-icon>
    </button>

    <!-- notifications_active, notifications_none -->
    <mat-menu #notificationsMenu="matMenu" [overlapTrigger]="false" xPosition="before">
      <ng-template matMenuContent>
        <div class="notification-wrap" *ngIf="!isNotificationLoading">
          <div *ngIf="notifications?.length > 0">
            <app-notification-item *ngFor="let item of notifications" [notification]="item"
              (remove)="removeNotification($event)"></app-notification-item>
          </div>
          <div *ngIf="notifications?.length == 0" class="no-notification">
            (0) Notifications
          </div>
          <button *ngIf="notifications?.length > 0 && !endOfNotifications" mat-button class="w-100"
            (click)="loadMoreNotifications(); $event.stopPropagation();"> Load more</button>
          <p *ngIf="endOfNotifications" style="justify-content: center;display: flex;cursor: pointer;">
            No more Notifications
          </p>
        </div>
        <div class="notification-wrap" *ngIf="isNotificationLoading">
          <app-loader [size]="'sm'" class="notification-loader" [text]="'Fetching Notifications...'"></app-loader>
        </div>
      </ng-template>
    </mat-menu>

    <button mat-icon-button [matMenuTriggerFor]="notificationsMenu" [style.color]="notificationColor"
      class="mobile_view" (click)="readNewNotificationAnswer()">

      <mat-icon *ngIf="!hasNewNotificationAnswers && unReadNotificationAnswerCount <= 0">
        contact_support
      </mat-icon>

      <mat-icon *ngIf="!hasNewNotificationAnswers && unReadNotificationAnswerCount > 0"
        matBadge="{{unReadNotificationAnswerCount}}" matBadgeColor="warn">
        contact_support
      </mat-icon>

      <mat-icon matBadge="{{unReadNotificationAnswerCount}}" matBadgeColor="warn" *ngIf="hasNewNotifications">
        contact_support
      </mat-icon>
    </button>

    <button mat-icon-button [matMenuTriggerFor]="notificationsMenu" [style.color]="notificationColor"
      class="mobile_view" (click)="readNewNotification()">
      <mat-icon *ngIf="!hasNewNotifications && unReadNotificationCount <= 0">notifications
      </mat-icon>

      <mat-icon *ngIf="!hasNewNotifications && unReadNotificationCount > 0" matBadge="{{unReadNotificationCount}}"
        matBadgeColor="warn">
        notifications
      </mat-icon>

      <mat-icon matBadge="{{unReadNotificationCount}}" matBadgeColor="warn" *ngIf="hasNewNotifications">
        notifications_active</mat-icon>
    </button>

    <button mat-icon-button class="mobile_view" [routerLink]="['/', userPath, userDetail?.slug]">
      <div class="icon">
        <img [src]="auth.profileImg" />
      </div>
    </button>
    <button mat-icon-button [matMenuTriggerFor]="info">
      <mat-icon>more_vert</mat-icon>
    </button>
    <mat-menu #info="matMenu" [overlapTrigger]="false" xPosition="before">
      <button mat-menu-item [routerLink]="['/', termsPath]">Terms & Conditions</button>
      <button mat-menu-item [routerLink]="['/', policyPath]">Privacy Policy</button>
      <button (click)="logOut()" mat-menu-item>Log Out</button>
      <!--      <button mat-menu-item>FAQ</button>-->
    </mat-menu>
    <mat-menu #menu="matMenu" [overlapTrigger]="false" xPosition="before">
      <button mat-menu-item [routerLink]="['/', userPath, userDetail?.slug]">
        <mat-icon>account_circle</mat-icon>
        <span>Profile</span>
      </button>
      <!--      <button mat-menu-item [matMenuTriggerFor]="settings">-->
      <!--        <mat-icon>settings</mat-icon>-->
      <!--        <span>Settings</span>-->
      <!--      </button>-->
    </mat-menu>
  </div>
</header>